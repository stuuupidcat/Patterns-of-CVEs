rules:
  - id: CVE-2021-29941
    languages: [rust]
    patterns:
      - pattern-either:
          - pattern: $MOD::set_len(...)
          - pattern: set_len(...)
      - pattern-inside: |
          fn $FUNC($ITER: impl ExactSizeIterator<Item = $ITEM>) {
            ...
            let $LEN = $ITER.len();
            ...
            unsafe {
                $VEC.set_len($LEN);
            }
            ...
          }
    message: |
      `std::iter::ExactSizeIterator::len` does not return the exact size of the iterator. It may return a value that is greater than the actual length of the iterator.
      Please do not pass returned value `$LEN` to `std::vec::Vec::set_len`, as this can lead to uninitialized memory.
    severity: ERROR
